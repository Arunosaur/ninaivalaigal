# Working State Snapshot

**Captured**: 2025-09-22 15:29:50 CDT
**Status**: OPERATIONAL

## Stack Status
Makefile:425: warning: overriding commands for target `build-api-unsafe'
Makefile:321: warning: ignoring old commands for target `build-api-unsafe'
Makefile:441: warning: overriding commands for target `redis-install'
Makefile:140: warning: ignoring old commands for target `redis-install'
Makefile:683: warning: overriding commands for target `test-auth'
Makefile:586: warning: ignoring old commands for target `test-auth'
Makefile:922: warning: overriding commands for target `dev-up'
Makefile:155: warning: ignoring old commands for target `dev-up'
Makefile:926: warning: overriding commands for target `dev-down'
Makefile:166: warning: ignoring old commands for target `dev-down'
Makefile:991: warning: overriding commands for target `test-performance'
Makefile:679: warning: ignoring old commands for target `test-performance'
== Containers ==
[32mâœ”[0m DB: nv-db running
[32mâœ”[0m PgB: nv-pgbouncer running
[32mâœ”[0m Redis: nv-redis running
[33mâš [0m mem0: nv-mem0 not running
[32mâœ”[0m API: nv-api running
[33mâš [0m UI: nv-ui not running

== Ports (localhost) ==
[32mâœ”[0m DB port 5433 open
[32mâœ”[0m PgB port 6432 open
[32mâœ”[0m Redis port 6379 open
[33mâš [0m mem0 port 7070 closed
[32mâœ”[0m API port 13370 open
[32mâœ”[0m UI port 8080 open

== Health ==
[32mâœ”[0m DB via PgBouncer: SELECT 1 OK
[32mâœ”[0m Redis: PING OK
[33mâš [0m Skipping mem0 health (curl missing or port closed)
[32mâœ”[0m API /health OK
[32mâœ”[0m UI /health OK

== Tips ==
  container logs -f nv-db
  container logs -f nv-pgbouncer
  container logs -f nv-redis
  container logs -f nv-mem0
  container logs -f nv-api
  container logs -f nv-ui

## Container Details

```
ID                         IMAGE                                               OS     ARCH   STATE    ADDR
ninaivalaigal-graph-redis  docker.io/library/redis:7-alpine                    linux  arm64  running  192.168.65.122
buildkit                   ghcr.io/apple/container-builder-shim/builder:0.6.0  linux  arm64  running  192.168.65.8
ninaivalaigal-graph-db     ninaivalaigal-graph-db:arm64                        linux  arm64  running  192.168.65.124
nv-pgbouncer               nina-pgbouncer:arm64                                linux  arm64  running  192.168.65.146
nv-redis                   docker.io/library/redis:7-alpine                    linux  arm64  running  192.168.65.151
nv-db                      docker.io/pgvector/pgvector:pg15                    linux  arm64  running  192.168.65.147
nv-api                     nina-api:arm64                                      linux  arm64  running  192.168.65.157
```

## API Container Dependencies

```
fastapi            0.117.1
psycopg2-binary    2.9.10
redis              6.4.0
structlog          25.4.0
uvicorn            0.32.0
```

## API Health Tests

âœ… /health endpoint: {"status":"ok"}
âœ… /health/detailed endpoint: Working

## Database Operations Test

âœ… Database operations: Import successful

## Recovery Instructions

If the stack goes down, use these commands to restore this working state:

```bash
# 1. Check what's actually down
make stack-status

# 2. If API is down, rebuild container
container build --no-cache -t nina-api:arm64 -f Dockerfile.api .

# 3. Verify dependencies
container run --rm nina-api:arm64 pip list | grep structlog

# 4. Restart API
container stop nv-api && container delete nv-api
./scripts/nv-api-start.sh

# 5. Verify working
curl http://localhost:13370/health
```

## Context

This snapshot was captured during database operations modularization work.
The stack was fully operational with all dependencies properly installed.
